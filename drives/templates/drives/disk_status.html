{% extends 'base.html' %}
{% load static %}
{% load i18n %}  
{% block title %}{% trans "Hard Drive Status" %}{% endblock %}

{% block content %}

<h1 class="mb-4">üóÉÔ∏è{% trans "System Disk Status" %} ({{ os_name }})</h1>

<div class="alert alert-info shadow-sm" role="alert">
    <i class="fas fa-microchip me-2"></i> 
    {% trans "Running on" %} ** {{ os_name }} ** {{ processor  }}. {% trans "This data reflects your current machine." %}
</div>

{% if disk_stats %}
    <div class="card shadow-lg">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-hdd me-2"></i> {% trans "Detected Disk Partitions" %}</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th scope="col">{% trans "Device / Mount Point" %}</th>
                        <th scope="col" class="text-end">{% trans "Total (GB)" %}</th>
                        <th scope="col" class="text-end">{% trans "Used (GB)" %}</th>
                        <th scope="col" class="text-end">{% trans "Free (GB)" %}</th>
                        <th scope="col">{% trans "Usage" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for disk in disk_stats %}
                    <tr>
                        <td>
                            <strong>{{ disk.mountpoint }}</strong>
                            <small class="d-block text-muted">{{ disk.device }} ({{ disk.fstype }})</small>
                        </td>
                        <td class="text-end">{{ disk.total }}</td>
                        <td class="text-end">{{ disk.used }}</td>
                        <td class="text-end">{{ disk.free }}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                
                                <!-- FIX: Using if/elif/else to set a variable 'color_class' for the progress bar -->
                                {% if disk.percent|default:0 > 90 %}
                                    {% with color_class='bg-danger' %}{% endwith %}
                                {% elif disk.percent|default:0 > 75 %}
                                    {% with color_class='bg-warning' %}{% endwith %}
                                {% else %}
                                    {% with color_class='bg-success' %}{% endwith %}
                                {% endif %}
                                
                                <!-- We are using the corrected 'color_class' variable here -->
                                <div class="progress-bar {{ color_class }}" 
                                     role="progressbar" 
                                     style="width: '{{disk.percent|default:0}}%';"
                                     aria-valuenow="{{ disk.percent|default:0 }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    {{ disk.percent|default:0 }}%
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% else %}
    <div class="alert alert-warning">
        {% trans "No disk partitions could be detected or read." %}
    </div>
{% endif %}

{% endblock %}